var FlatfileImporter=function(){"use strict";var d="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(e,t){return e(t={exports:{}},t.exports),t.exports}function t(e){if(arguments.length<1)throw new TypeError("1 argument is required");if("object"!=typeof e)throw new TypeError("Argument 1 (”other“) to Node.contains must be an instance of Node");var t=e;do{if(this===t)return!0}while(t=t&&t.parentNode);return!1}e(function(e,t){!function(){function e(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){return n.reject(e)})})}function t(n){return new this(function(r,e){if(!n||void 0===n.length)return e(new TypeError(typeof n+" "+n+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var i=Array.prototype.slice.call(n);if(0===i.length)return r([]);var a=i.length;for(var t=0;t<i.length;t++)!function t(n,e){if(e&&("object"==typeof e||"function"==typeof e)){var o=e.then;if("function"==typeof o)return void o.call(e,function(e){t(n,e)},function(e){i[n]={status:"rejected",reason:e},0==--a&&r(i)})}i[n]={status:"fulfilled",value:e},0==--a&&r(i)}(t,i[t])})}var n=setTimeout;function c(e){return Boolean(e&&void 0!==e.length)}function o(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(e,this)}function r(n,o){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn(function(){var e,t=1===n._state?o.onFulfilled:o.onRejected;if(null!==t){try{e=t(n._value)}catch(e){return void s(o.promise,e)}a(o.promise,e)}else(1===n._state?a:s)(o.promise,n._value)})):n._deferreds.push(o)}function a(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void l(t);if("function"==typeof n)return void f((o=n,r=e,function(){o.apply(r,arguments)}),t)}t._state=1,t._value=e,l(t)}catch(e){s(t,e)}var o,r}function s(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)r(e,e._deferreds[t]);e._deferreds=null}function u(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function f(e,t){var n=!1;try{e(function(e){n||(n=!0,a(t,e))},function(e){n||(n=!0,s(t,e))})}catch(e){if(n)return;n=!0,s(t,e)}}i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(o);return r(this,new u(e,t,n)),n},i.prototype.finally=e,i.all=function(t){return new i(function(r,i){if(!c(t))return i(new TypeError("Promise.all accepts an array"));var a=Array.prototype.slice.call(t);if(0===a.length)return r([]);var s=a.length;for(var e=0;e<a.length;e++)!function t(n,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var o=e.then;if("function"==typeof o)return void o.call(e,function(e){t(n,e)},i)}a[n]=e,0==--s&&r(a)}catch(e){i(e)}}(e,a[e])})},i.allSettled=t,i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(r){return new i(function(e,t){if(!c(r))return t(new TypeError("Promise.race accepts an array"));for(var n=0,o=r.length;n<o;n++)i.resolve(r[n]).then(e,t)})},i._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){n(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var h=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==d)return d;throw new Error("unable to locate global object")}();"function"!=typeof h.Promise?h.Promise=i:h.Promise.prototype.finally?h.Promise.allSettled||(h.Promise.allSettled=t):h.Promise.prototype.finally=e}()});var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var r=function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function s(e,a,s,c){return new(s=s||Promise)(function(n,t){function o(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,r)}i((c=c.apply(e,a||[])).next())})}function c(n,o){var r,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(n,s)}catch(e){t=[6,e],i=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var n=e(function(e){var o=Object.prototype.hasOwnProperty,d="~";function n(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(e,t,n,o,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");r=new i(n,o||e,r),t=d?d+t:t;return e._events[t]?e._events[t].fn?e._events[t]=[e._events[t],r]:e._events[t].push(r):(e._events[t]=r,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function t(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(d=!1)),t.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(d?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},t.prototype.listeners=function(e){var e=d?d+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var n=0,o=t.length,r=new Array(o);n<o;n++)r[n]=t[n].fn;return r},t.prototype.listenerCount=function(e){e=d?d+e:e,e=this._events[e];return e?e.fn?1:e.length:0},t.prototype.emit=function(e,t,n,o,r,i){var a=d?d+e:e;if(!this._events[a])return!1;var s,c=this._events[a],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,r),!0;case 6:return c.fn.call(c.context,t,n,o,r,i),!0}for(h=1,s=new Array(l-1);h<l;h++)s[h-1]=arguments[h];c.fn.apply(c.context,s)}else for(var u,f=c.length,h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,n);break;case 4:c[h].fn.call(c[h].context,t,n,o);break;default:if(!s)for(u=1,s=new Array(l-1);u<l;u++)s[u-1]=arguments[u];c[h].fn.apply(c[h].context,s)}return!0},t.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},t.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},t.prototype.removeListener=function(e,t,n,o){e=d?d+e:e;if(!this._events[e])return this;if(!t)return c(this,e),this;var r=this._events[e];if(r.fn)r.fn!==t||o&&!r.once||n&&r.context!==n||c(this,e);else{for(var i=0,a=[],s=r.length;i<s;i++)(r[i].fn!==t||o&&!r[i].once||n&&r[i].context!==n)&&a.push(r[i]);a.length?this._events[e]=1===a.length?a[0]:a:c(this,e)}return this},t.prototype.removeAllListeners=function(e){return e?(e=d?d+e:e,this._events[e]&&c(this,e)):(this._events=new n,this._eventsCount=0),this},t.prototype.off=t.prototype.removeListener,t.prototype.addListener=t.prototype.on,t.prefixed=d,t.EventEmitter=t,e.exports=t}).EventEmitter,i=["interactive","complete"],a=function(n,o){return new Promise(function(e){n&&"function"!=typeof n&&(o=n,n=null),o=o||window.document;function t(){return e(void(n&&setTimeout(n)))}-1!==i.indexOf(o.readyState)?t():o.addEventListener("DOMContentLoaded",t)})};a.resume=function(t){return function(e){return a(t).then(function(){return e})}};function l(e){return new f(e)}function u(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function f(e){if(!(this instanceof f))return new f(e);(e=e||{}).nodeType&&(e={el:e}),this.opts=e,this.el=e.el||document.body,"object"!=typeof this.el&&(this.el=document.querySelector(this.el))}f.prototype.add=function(e){var t=this.el;if(t){if(""===t.className)return t.className=e;var n=t.className.split(" ");return-1<u(n,e)?n:(n.push(e),t.className=n.join(" "),n)}},f.prototype.remove=function(e){var t=this.el;if(t&&""!==t.className){var n=t.className.split(" "),e=u(n,e);return-1<e&&n.splice(e,1),t.className=n.join(" "),n}},f.prototype.has=function(e){var t=this.el;if(t)return-1<u(t.className.split(" "),e)},f.prototype.toggle=function(e){this.el&&(this.has(e)?this.remove(e):this.add(e))};var h,p,m=e(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ERR_IFRAME_ALREADY_ATTACHED_TO_DOM=t.ERR_NOT_IN_IFRAME=t.ERR_CONNECTION_TIMEOUT=t.ERR_CONNECTION_DESTROYED=void 0;var y="handshake",w="handshake-reply",d="reply",p="fulfilled",l="rejected",k="message",b="ConnectionDestroyed";t.ERR_CONNECTION_DESTROYED=b;var _="ConnectionTimeout";t.ERR_CONNECTION_TIMEOUT=_;var o="NotInIframe";t.ERR_NOT_IN_IFRAME=o;var r="IframeAlreadyAttachedToDom";t.ERR_IFRAME_ALREADY_ATTACHED_TO_DOM=r;function g(){if(O.debug){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];(e=console).log.apply(e,["[Penpal]"].concat(n))}}function $(e){var t=[];return e(function(){t.forEach(function(e){e()})}),{then:function(e){t.push(e)}}}function u(e){return{name:e.name,message:e.message,stack:e.stack}}function E(e,t,n,r,o){var l=t.localName,u=t.local,f=t.remote,h=t.remoteOrigin,i=!1;function a(c){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(g("".concat(l,": Sending ").concat(c,"() call")),f.closed&&r(),i){var o=new Error("Unable to send ".concat(c,"() call due ")+"to destroyed connection");throw o.code=b,o}return new O.Promise(function(r,i){function a(e){var t,n,o;e.source===f&&e.origin===h&&e.data.penpal===d&&e.data.id===s&&(g("".concat(l,": Received ").concat(c,"() reply")),u.removeEventListener(k,a),t=e.data.returnValue,e.data.returnValueIsError&&(n=t,o=new Error,Object.keys(n).forEach(function(e){return o[e]=n[e]}),t=o),(e.data.resolution===p?r:i)(t))}var s=m();u.addEventListener(k,a),f.postMessage({penpal:"call",id:s,methodName:c,args:t},h)})}}g("".concat(l,": Connecting call sender")),o.then(function(){i=!0}),n.reduce(function(e,t){return e[t]=a(t),e},e)}function C(e,n,t){var i=e.localName,o=e.local,a=e.remote,s=e.remoteOrigin,c=!1;function r(e){var o,t,r;e.source===a&&e.origin===s&&"call"===e.data.penpal&&(e=e.data,o=e.methodName,t=e.args,r=e.id,g("".concat(i,": Received ").concat(o,"() call")),o in n&&(e=function(n){return function(e){if(g("".concat(i,": Sending ").concat(o,"() reply")),c)g("".concat(i,": Unable to send ").concat(o,"() reply due to destroyed connection"));else{var t={penpal:d,id:r,resolution:n,returnValue:e};n===l&&e instanceof Error&&(t.returnValue=u(e),t.returnValueIsError=!0);try{a.postMessage(t,s)}catch(e){throw"DataCloneError"===e.name&&a.postMessage({penpal:d,id:r,resolution:l,returnValue:u(e),returnValueIsError:!0},s),e}}}},new O.Promise(function(e){return e(n[o].apply(n,t))}).then(e(p),e(l))))}g("".concat(i,": Connecting call receiver")),o.addEventListener(k,r),t.then(function(){c=!0,o.removeEventListener(k,r)})}var n,i={"http:":"80","https:":"443"},a=/^(https?:|file:)?\/\/([^/:]+)?(:(\d+))?/,O={ERR_CONNECTION_DESTROYED:b,ERR_CONNECTION_TIMEOUT:_,ERR_NOT_IN_IFRAME:o,ERR_IFRAME_ALREADY_ATTACHED_TO_DOM:r,Promise:function(){try{return window?window.Promise:null}catch(e){return null}}(),debug:!1},m=(n=0,function(){return++n});O.connectToChild=function(e){var l,t=e.url,u=e.appendTo,f=e.iframe,n=e.methods,h=void 0===n?{}:n,d=e.timeout;if(f&&f.parentNode){e=new Error("connectToChild() must not be called with an iframe already attached to DOM");throw e.code=r,e}var p=new $(function(e){l=e}),m=window,v=function(e){var t,n,o=document.location,e=a.exec(e),o=e?(t=e[1]||o.protocol,n=e[2],e[4]):(t=o.protocol,n=o.hostname,o.port);if("file:"===t)return"null";o=o&&o!==i[t]?":".concat(o):"";return"".concat(t,"//").concat(n).concat(o)}((f=f||document.createElement("iframe")).src=t);return{promise:new O.Promise(function(o,t){var r;void 0!==d&&(r=setTimeout(function(){var e=new Error("Connection to child timed out after ".concat(d,"ms"));e.code=_,t(e),l()},d));function n(e){var t,n=f.contentWindow;e.source===n&&e.origin===v&&e.data.penpal===y&&(g("Parent: Received handshake, sending reply"),t="null"===e.origin?"*":e.origin,e.source.postMessage({penpal:w,methodNames:Object.keys(h)},t),n={localName:"Parent",local:m,remote:n,remoteOrigin:t},a&&a(),t=new $(function(e){p.then(e),a=e}),C(n,h,t),i&&i.forEach(function(e){delete s[e]}),i=e.data.methodNames,E(s,n,i,l,p),clearTimeout(r),o(s))}var i,a,s={};m.addEventListener(k,n),g("Parent: Loading iframe"),(u||document.body).appendChild(f);var c=setInterval(function(){document.body.contains(f)||(clearInterval(c),l())},6e4);p.then(function(){f.parentNode&&f.parentNode.removeChild(f),m.removeEventListener(k,n),clearInterval(c);var e=new Error("Connection destroyed");e.code=b,t(e)})}),iframe:f,destroy:l}},O.connectToParent=function(){var a,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.parentOrigin,s=void 0===t?"*":t,t=e.methods,c=void 0===t?{}:t,n=e.timeout;if(window===window.top){e=new Error("connectToParent() must be called within an iframe");throw e.code=o,e}var l=new $(function(e){a=e}),u=window,f=u.parent;return{promise:new O.Promise(function(o,t){var r;void 0!==n&&(r=setTimeout(function(){var e=new Error("Connection to parent timed out after ".concat(n,"ms"));e.code=_,t(e),a()},n));function i(e){var t,n;"*"!==s&&s!==e.origin||e.source!==f||e.data.penpal!==w||(g("Child: Received handshake reply"),u.removeEventListener(k,i),t={localName:"Child",local:u,remote:f,remoteOrigin:e.origin},n={},C(t,c,l),E(n,t,e.data.methodNames,a,l),clearTimeout(r),o(n))}u.addEventListener(k,i),l.then(function(){u.removeEventListener(k,i);var e=new Error("Connection destroyed");e.code=b,t(e)}),g("Child: Sending handshake"),f.postMessage({penpal:y,methodNames:Object.keys(c)},s)}),destroy:a}},t.default=O}),v=(h=m)&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h,y=function(e){this.$meta=e,this.originalRows=this.$meta.count_rows,this.acceptedRows=this.$meta.count_rows_accepted||null,this.originalColumns=this.$meta.count_columns||null,this.matchedColumns=this.$meta.count_columns_matched||null},w=function(e){this.$user=e,this.id=this.$user.id,this.userId=this.$user.userId,this.name=this.$user.name,this.email=this.$user.name,this.companyName=this.$user.companyName,this.companyId=this.$user.companyId},k=function(e){this.$file=e,this.id=this.$file.id,this.filename=this.$file.filename,this.filesize=this.$file.filesize,this.filetype=this.$file.filetype,this.url=this.$file.url},b=function(e,t){this.$meta=t,this.$data=e,this.rawOutput=this.$data,this.validData=this.$data.filter(function(e){return e.valid}).filter(function(e){return!e.deleted}).map(function(e){return e.data}),this.data=this.validData,this.deletedData=this.$data.filter(function(e){return e.deleted}).map(function(e){return e.data}),this.allData=this.$data.map(function(e){return e.data}),this.remainingChunks=Math.ceil((this.totalChunks-this.currentChunk)/this.$meta.inChunks),this.totalChunks=Math.ceil(this.$meta.count_rows_accepted/this.$meta.inChunks),this.chunkSize=this.$meta.inChunks,this.currentChunk=(this.$meta.pointer+this.chunkSize)/this.chunkSize,this.hasMore=this.$meta.hasMore},_=(g.prototype.getCSVFile=function(){if(this.$meta.originalFile){if("csv"===this.$meta.originalFile.filetype)return new k(this.$meta.originalFile);if(this.$meta.csvFile)return new k(this.$meta.csvFile)}return null},g.prototype.getNextChunk=function(){var n=this;return new Promise(function(t,e){if(!n.$meta.inChunks)return e('"nextChunk()" is only accessible when using "inChunks". Please see docs for "requestDataFromUser".');n.$importer.$ready.then(function(e){console.log("child.nextChunk()"),e.nextChunk().then(function(e){console.log("nextChunk()",e),t(e.results.length?new b(e.results,e.meta):null)},function(e){console.log("nextChunk(err)",e)})})})},g.prototype.blobOnly=function(e,t,n){if(void 0===n&&(n="nextChunk()"),this.$meta.inChunks)throw new Error('"'+t+'" is not accessible when using "inChunks". Please see docs for "'+n+'" instead.');return e},g);function g(e,t,n){var o=this;this.$meta=t,this.$data=e,this.$importer=n,this.rawOutput=this.blobOnly(this.$data,"rawOutput"),this.validData=this.blobOnly(this.$data.filter(function(e){return e.valid}).filter(function(e){return!e.deleted}).map(function(e){return e.data}),"validData"),this.data=this.blobOnly(this.validData,"data"),this.deletedData=this.blobOnly(this.$data.filter(function(e){return e.deleted}).map(function(e){return e.data}),"deletedData"),this.allData=this.blobOnly(this.$data.map(function(e){return e.data}),"allData"),this.batchId=this.$meta.batchID,this.stats=new y(this.$meta),this.customer=this.$meta.endUser?new w(this.$meta.endUser):null,this.originalFile=this.$meta.originalFile?new k(this.$meta.originalFile):null,this.csvFile=this.getCSVFile(),this.fileName=this.$meta.filename||null,this.managed=this.$meta.managed||!1,this.manual=this.$meta.manual,this.config=this.$meta.config,this.parsingConfig=this.$meta.parsing_config,this.skippedRows=this.$meta.skipped_rows||null,this.headersRaw=this.$meta.headers_raw||null,this.headersMatched=this.$meta.headers_matched||null,this.customColumns=this.$meta.custom_columns,this.categoryFieldMap=this.$meta.category_field_map||null,this.failureReason=this.$meta.failure_reason||null,this.submittedAt=this.$meta.submitted_at||null,this.failedAt=this.$meta.failed_at||null,this.createdAt=this.$meta.created_at,this.stylesheet=this.$meta.stylesheet,this.nextChunk=function(){return o.getNextChunk()}}var $,n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(E,$=n),E.setMountUrl=function(e){this.MOUNT_URL=e},E.setVersion=function(e){switch(e){case 1:this.MOUNT_URL="https://kiosk-lite.flatfile.io/?key=:key";break;case 2:this.MOUNT_URL="https://portal-2.flatfile.io/?key=:key";break;default:throw new Error(e+" is not a valid version")}},E.prototype.open=function(n){var o=this;if(void 0===n&&(n={}),null===this.handshake)throw new Error("This importer has been destroyed.");n=r(r({},n),{bulkInit:!0,hasVirtualRecordHook:!!this.$virtualRecordHook,hasRecordHook:!!this.$recordHook,hasInteractionEventCallback:!!this.$interactionEventCallback,stepHooks:Object.keys(this.$stepHooks),fieldHooks:this.$fieldHooks.map(function(e){return e.field}),endUser:this.customer}),this.$ready.then(function(e){l(document.body).add("flatfile-active");var t=document.getElementById("flatfile-"+o.uuid);t&&(t.style.display="block"),e.open(n)})},E.prototype.load=function(){var i=this;return new E.Promise(function(t,n){i.open();var o=function(){i.removeListener("close",r),i.removeListener("complete",e)};function e(e){t(e),o()}function r(e){n(e),o()}i.on("close",r),i.on("complete",e)})},E.prototype.requestDataFromUser=function(e){return void 0===e&&(e={}),this.open(r(r({},e),{inChunks:e.inChunks||null,expectsExpandedResults:!0})),this.responsePromise()},E.prototype.displayLoader=function(t){this.$ready.then(function(e){e.displayLoader(t)})},E.prototype.displayError=function(t){this.$ready.then(function(e){e.displayError(t)})},E.prototype.requestCorrectionsFromUser=function(t,n){return this.$ready.then(function(e){e.displayError(t,n)}),this.responsePromise()},E.prototype.displaySuccess=function(t){var n=this;return this.$ready.then(function(e){e.displaySuccess(t)}),new Promise(function(e){var t=function(){e(),n.removeListener("close",t)};n.on("close",t)})},E.prototype.setCustomer=function(e){this.customer=e},E.prototype.setLanguage=function(t){this.$ready.then(function(e){e.setLanguage(t)})},E.prototype.addVirtualField=function(t,n){void 0===n&&(n={}),this.$ready.then(function(e){e.addVirtualField({field:t,options:n})})},E.prototype.registerRecordHook=function(e){this.$recordHook=e},E.prototype.registerVirtualRecordHook=function(e){this.$virtualRecordHook=e},E.prototype.registerNetworkErrorCallback=function(e){this.$networkErrorCallback=e},E.prototype.registerBeforeFetchCallback=function(e){this.$beforeFetchCallback=e},E.prototype.registerInteractionEventCallback=function(e){this.$interactionEventCallback=e},E.prototype.registerFieldHook=function(e,t){this.$fieldHooks.push({field:e,cb:t})},E.prototype.registerStepHook=function(e,t){this.$stepHooks[e]=t},E.prototype.close=function(){this.$ready.then(function(e){e.close()})},E.prototype.destroy=function(){var e;null!==(e=document.getElementById("flatfile-"+this.uuid))&&void 0!==e&&e.remove(),this.handshake=null},E.prototype.handleClose=function(){l(document.body).remove("flatfile-active");var e=document.getElementById("flatfile-"+this.uuid);e&&(e.style.display="none")},E.prototype.initialize=function(){var e,t,i=this;(e="\n      .flatfile-component {\n        position: fixed;\n        top: 0;\n        bottom: 0;\n        right: 0;\n        left: 0;\n        display: none;\n        z-index: 100000;\n      }\n      .flatfile-component iframe {\n        width: 100%;\n        height: 100%;\n        position: absolute;\n        border-width: 0;\n      }\n      body.flatfile-active {\n        overflow: hidden;\n        overscroll-behavior-x: none;\n      }\n    ")&&(p||((p=document.createElement("style")).setAttribute("type","text/css"),null!==(t=document.querySelector("head"))&&void 0!==t&&t.appendChild(p),65279===e.charCodeAt(0)&&(e=e.substr(1)),p.styleSheet?p.styleSheet.cssText=e:p.textContent=e)),document.body.insertAdjacentHTML("beforeend",'<div id="flatfile-'+this.uuid+'" class="flatfile-component"></div>');var n=setTimeout(function(){return console.error("[Flatfile] Looks like Portal takes too long to load. Please visit our Help Center (https://support.flatfile.com/hc/en-us/articles/4408071883924-CORS-Referrer-Policy-Recommendations) or contact Flatfile support for any help.")},5e3);this.handshake=v.connectToChild({appendTo:document.getElementById("flatfile-"+this.uuid)||void 0,url:E.MOUNT_URL.replace(":key",this.apiKey),methods:{results:function(e){i.emit("results",e.results,e.meta)},complete:function(e){i.emit("complete",e.rows,e.meta)},close:function(){i.emit("close"),i.handleClose()},networkErrorCallback:function(e){return i.$networkErrorCallback?i.$networkErrorCallback(e):void 0},beforeFetchCallback:function(e){return i.$beforeFetchCallback?i.$beforeFetchCallback(e):void 0},interactionEventCallback:function(e){return i.$interactionEventCallback?i.$interactionEventCallback(e):void 0},dataHookCallback:function(t,n,o){try{return i.$recordHook?i.$recordHook(t,n,o):void 0}catch(e){e.message;var r=e.stack;return console.error("Flatfile Record Hook Error on row "+n+":\n  "+r,{row:t,mode:o}),{}}},bulkHookCallback:function(e,o){try{return"virtual"===o?i.$virtualRecordHook?Promise.all(e.map(function(e){var t=e[0],n=e[1];try{return i.$virtualRecordHook(t,n,o)}catch(e){throw e.row=t,e.index=n,e}})):void 0:i.$recordHook?Promise.all(e.map(function(e){var t=e[0],n=e[1];try{return i.$recordHook(t,n,o)}catch(e){throw e.row=t,e.index=n,e}})):void 0}catch(e){var t=e.stack,n=e.row,r=e.index;return console.error("Flatfile Record Hook Error on row "+r+":\n  "+t,{row:n,mode:o}),{}}},fieldHookCallback:function(t,n){var e=i.$fieldHooks.find(function(e){return e.field===n.field});if(e)try{return e.cb(t,n)}catch(e){var o=e.stack;return console.error('Flatfile Field Hook Error on field "'+n.field+'":\n  '+o,{meta:n,values:t}),[]}},stepHookCallback:function(n,o){return s(i,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:if(!this.$stepHooks[n])return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.$stepHooks[n](o)];case 2:return[2,e.sent()];case 3:return t=e.sent(),t=t.stack,console.error('Flatfile Step Hook Error on step "'+n+'":\n  '+t,{payload:o}),[3,4];case 4:return[2]}})})},ready:function(){return i.handshake.promise.then(function(e){i.$resolver(e),i.customer&&e.setUser(i.customer)}).catch(function(e){console.error(e)}),i.options}}}),this.handshake.promise.then(function(){n&&clearTimeout(n)}),this.handshake.promise.catch(function(e){i.$rejecter(e)})},E.prototype.$generateUuid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},E.prototype.responsePromise=function(){var a=this;return new Promise(function(r,t){var e=function(n,o){return s(a,void 0,void 0,function(){var t;return c(this,function(e){return t=new _(n,o,this),r(t),i(),[2]})})};function n(e){t(e),i()}var o=a;function i(){o.removeListener("close",n),o.removeListener("results",e)}a.on("close",n),a.on("results",e)})},E.Promise=Promise,E.MOUNT_URL="https://portal-2.flatfile.io/?key=:key",E);function E(e,t,n){var o=$.call(this)||this;return o.$fieldHooks=[],o.$stepHooks={},o.apiKey=e,o.options=t,o.customer=n,o.uuid=o.$generateUuid(),o.$ready=new E.Promise(function(e,t){o.$resolver=e,o.$rejecter=t}),a(function(){o.initialize()}),o}return"object"==typeof document&&"function"!=typeof document.contains&&(Object.getPrototypeOf(document).contains=t),n}();